<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>巧书后台首页</title>
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="stylesheet" href="__PUBLIC__/css/bootstrap.css">
    <link rel="stylesheet" href="__PUBLIC__/css/font-awesome.min.css">
    <link rel="stylesheet" href="__PUBLIC__/css/ionicons.min.css">
    <link rel="stylesheet" href="__PUBLIC__/css/AdminLTE.css">
    <link rel="stylesheet" href="__PUBLIC__/css/_all-skins.css">
      <link rel="stylesheet" href="__PUBLIC__/css/base.css">
</head>
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">

    <!-------------头部模板 header.html main-header begin-->
    <include file="./Public/Tpl/header.html" />
    <!-------------头部模板 header.html main-header end-->


    <!------------- 左侧菜单栏 leftMenu.html aside begin-->
    <include file="./Public/Tpl/leftMenu.html" />
    <!------------- 左侧菜单栏 leftMenu.html aside end-->

    <!-- 所有内容部分 -->
    <div class="content-wrapper">
		     <section class="content" id="fixed">
		   		  <div class="box border-box">
		   		  <div class="box-body box-profile">
		   		  <form class="form-inline" action="{$Think.config.QS_BASE_PATH}/User/listUser" method="post" id="userForm" name="userForm">
                      <input name="lids" id="lids" type="hidden" value="{$lids}">
                      <input name="lidsName" id="lidsName" type="hidden" value="{$lidsName}">
                      <input name="scoreIds" id="scoreIds" type="hidden" value="{$scoreIds}">
                      <input name="scoreName" id="scoreName" type="hidden" value="{$scoreName}">
                      <input name="sort" id="sort" type="hidden" value="{$sort}">
                      <input name="invite_code" id="invite_code" type="hidden" value="{$invite_code}">
                      <input name="recorderCnt" id="recorderCnt" type="hidden" value="{$recorderCnt}">
                      <input name="pageCnt" id="pageCnt" type="hidden" value="{$pageCnt}">
                      <input name="gotoPage" id="gotoPage" type="hidden" value="{$gotoPage}">
                      <input name="pageSize" id="pageSize" type="hidden" value="{$pageSize}">

		   		  	<div class="form-group">
		   		  	<div class="row">
		   		  		<div class="col-lg-4 col-xs-12 mb-10">
		   		  			<input type="text" class="form-control input_style mr-10" placeholder="用户名" name="name" value="{$name}">
		   		  			<select class="form-control select2 input_style2" name="invite_code" onchange="doSearch()">
 			   		  		  <option value="" <if condition="$invite_code == '' "> selected </if> >全部显示</option>
								<option value="HAVE" <if condition=" $invite_code == 'HAVE' "> selected </if>  >有邀请码</option>
				              <option value="NO" <if condition=" $invite_code == 'NO' "> selected </if> >没有邀请码</option>
		                    </select>
		   		  		</div>
		   		  		<!--用户评分-->
		   		  	<div class="col-lg-4 col-xs-12">
		            		<div class="box border collapsed-box">
				           	<div class="box-header with-border h30 box_content">
				              	<span class="user_score">&nbsp;&nbsp;用户评分</span>
				              <div class="box-tools">
				                <button name="score" id="score" type="button" class="btn btn-box-tool re" data-widget="collapse" ><i class="fa fa-plus incre"></i>
				                </button>
				              </div>
				            </div>
				            <div class="box-body box_close">
				              <ul class="nav nav-pills nav-stacked">
				                <li>
                                    <button type="btn" class="btn btn1 btn-border btn-flat bg mr-10 f12" onclick="allScore()">全部</button>
				                	<button type="btn" class="btn btn1 btn-border btn-flat bg mr-10 f12" onclick="haveScore()">有评分</button>
				                	<button type="btn" class="btn btn1 btn-border btn-flat bg mr-10 f12" onclick="noScore()">没有评分</button>
				                </li>
		
		                      <volist name="scorelabelList" id="scorelabel">
				                <li class="m10" id='{$scorelabel.name}'>
				                	<span class="display">{$scorelabel.name}</span>
				                	<span class="btn_style score_btn1" a='{$scorelabel.id}' s='1'>1分</span>
				                	<span class="btn_style score_btn1" a='{$scorelabel.id}' s='2'>2分</span>
				                	<span class="btn_style score_btn1" a='{$scorelabel.id}' s='3'>3分</span>
				                	<span class="btn_style score_btn1" a='{$scorelabel.id}' s='4'>4分</span>
				                	<span class="btn_style score_btn1 no-margin" a='{$scorelabel.id}' s='5'>5分</span>
				                </li>
		                      </volist>
		
				                <li class="text-right m10">
				                	<span id='sure_score' class="btn_style score_btn2">确定</span>
				                	<span class="btn_style score_btn2 no-margin" id="cancel_score">取消</span>
				                </li>
				              </ul>
				            </div>
		         		</div>
		         </div><!--/.用户评分-->
		         
		         
		          <!--用户标签-->
		          <div class="col-lg-4 col-xs-12">
		 			<div class="box border collapsed-box">
		            <div class="box-header with-border h30 tag_content">
		              <span class="user_tag">&nbsp;&nbsp;标签</span>
		              <div class="box-tools">
                        <button type="button" class="btn btn-box-tool re" data-widget="collapse"><i class="fa fa-plus incre"></i>
                        </button>
                   	 </div>
		            </div>
		            <div class="box-body box_close">
		              <ul class="nav nav-pills nav-stacked">
		                <li>
                            <button type="btn" class="btn btn1 btn-border btn-flat bg mr-10 f12" onclick="allLabel()">全部</button>
		                	<button type="btn" class="btn btn1 btn-border btn-flat bg mr-10 f12" onclick="haveLabel()">有标签</button>
		                	<button type="btn" class="btn btn1 btn-border btn-flat bg mr-10 f12" onclick="noLabel()">没有标签</button>
		                </li>
                      
		                <li class="m10">
		                	<volist name="labelList" id="label">
		                		<span class="btn_style tag_btn m10" a='{$label.id}' id='{$label.name}'>{$label.name}</span>
		                	</volist>
		                </li>
                    

		                <li class="text-right m10">
		                	<span id='sure_tag' class="btn_style score_btn2">确定</span>
				            <span class="btn_style score_btn2 no-margin" id="cancel_tag">取消</span>
		                </li>

		              </ul>
		            </div>
		            <!-- /.box-body -->
		          </div>
		 		</div><!--/.用户标签-->
		 </div>	
		 
		          <div class='row'>
		          	<div class="col-lg-2 col-xs-12">
		          		<div class="btn-group">
		          			<button type="button" class="btn_style search f14" onclick="$('#gotoPage').val(1);doSearch()">搜索</button>
		          		</div>
		          	</div>
		          	<div class="col-lg-5 col-xs-12 text-right m5">
		          		<div>
		          			<span>排序</span>
                            <if condition="$sort=='reg_time'">
				          	    <button type="button" class="btn_style active1" onclick="setSort('reg_time')">按注册时间排序</button>
                           <else/>
                               <button type="button" class="btn_style" onclick="setSort('reg_time')">按注册时间排序</button>
                           </if>

                            <if condition="$sort=='login_time'">
                                <button type="button" class="btn_style active1" onclick="setSort('login_time')">按登陆时间排序</button>
                            <else/>
                                <button type="button" class="btn_style" onclick="setSort('login_time')">按登陆时间排序</button>
                            </if>


                            <if condition="$sort=='amt_money'">
                                <button type="button" class="btn_style active1" onclick="setSort('amt_money')">按收益排序</button>
                            <else/>
                                <button type="button" class="btn_style" onclick="setSort('amt_money')">按收益排序</button>
                            </if>



		          		</div>
		          	</div>
		          	<div class="col-lg-5 col-xs-12 text-right m5">
                        <ul class="pagination">
                            <li><a href="###" onclick="gotoPage({$gotoPage-1})">上一页</a></li>

                            <!--<for start="0" end="$pageCnt">-->
                                <!--<if condition="$i+1 eq $gotoPage">-->
                                    <!--<li class="active"><a href="###" onclick="gotoPage({$i+1})">{$i+1}</a></li>-->
                                    <!--<else/>-->
                                    <!--<li><a href="###" onclick="gotoPage({$i+1})">{$i+1}</a></li>-->
                                <!--</if>-->
                            <!--</for>-->

                                <li>跳至</span><select name="aGoPage" id="aGoPage">
                                    <option value=""> </option>
                                    <for start="0" end="$pageCnt">
                                        <if condition="$i+1 eq $gotoPage">
                                            <option value="{$gotoPage}" selected >{$i+1}</option>
                                            <else/>
                                            <option value="{$gotoPage}">{$i+1}</option>
                                        </if>
                                    </for>
                                </select>页</li>

                            <li><a href="###" onclick="gotoPage({$gotoPage+1})">下一页</a></li>
                        </ul>

		          	</div>
		          </div>
		   		  </div>
		   		  </form>
		        </div>
		   		</div>
		</section>
		
		<section class="content" id="alert_user">
			<div class="box box-style">
			 <volist name="userList" id="row" key="k" >
			<div <if condition="$k%2== '0'"> style="background-color:#FFFFF0;"</if> class="row user_list_bor box_hover" id="userInfo" >
		        <div class="col-lg-4 col-xs-6 re alert_box">
		          	<div class="pull-left">
                        <a target="_blank" href="http://www.qiaobooks.com/Home/{$row['userInfo'][0]['id']}">
                            <empty name="row['userInfo'][0]['head_img']">
                                <img src="http://tva2.sinaimg.cn/crop.0.0.256.256.180/006kopAXjw8f1xnvcum68j30740740su.jpg" width="50" height="50" class="pull-left mr-10">
                            <else/>
                                <if condition="stripos($row['userInfo'][0]['head_img'],'http') nheq false">
                                    <img src="{$row['userInfo'][0]['head_img']}" width="50" height="50" class="pull-left mr-10">
                                <else/>
                                    <img src="http://img.qiaobooks.com/{$row['userInfo'][0]['head_img']}" width="50" height="50" class="pull-left mr-10">
                                </if>
                            </empty>
                        </a>
				 			<div class="author_name"><a target="_blank" href="http://www.qiaobooks.com/Home/{$row['userInfo'][0]['id']}">{$row['userInfo'][0]['nick_name']}</a></div>
				 			<div class="c2 f14 c2">ID:{$row['userInfo'][0]['id']}</div>
				 			<div class="clear"></div>
				 			<ul class="fl2 c2">
						 		<li class="w210 f12">邀请码：{$row['userInfo'][0]['invite_code']}</li>
                                <li class="w210 f12">手机号码：{$row['userInfo'][0]['mobile']}</li>
						 		<li class="w210 f12">注册时间：<span>{:date('Y-m-d H:i:s' , $row['userInfo'][0]['reg_time'])}</span></li>
						 		<li class="w210 f12">最近登陆：<span>{$row['userInfo'][0]['login_time']}</span></li>
						 		<li class="w210 f12">在线时长：<span>{$row['userInfo'][0]['stay_time']}</span></li>
						 		<li class="w210 f12">
					 				<div class="input-group m5">
		                   				<span class="input-group-addon h24 w36">备注</span>
		                				<input type="text" class="form-control h24 w165" name="remark" id="remark_{$row['userInfo'][0]['id']}" oldval="{$row['userInfo'][0]['remark']}" value="{$row['userInfo'][0]['remark']}" onblur="remarkUser({$row['userInfo'][0]['id']},this)">
		              				</div>
				 				</li>
				 			</ul>
					</div>
					 			
				 			<ul class="pull-right">
				 				<li><button class="a0 details mb-65 check" value="{$row['userInfo'][0]['id']}">查看详情</button></li>
				 				<!--<li><a href="javaScript:void(0);" class="a0 details">清除数据</a></li>-->
				 				<li>
                                    <if condition="$row['userInfo'][0]['status'] eq 1">
                                        <a href="javaScript:void(0);" t="{$row['userInfo'][0]['id']}" s="{$row['userInfo'][0]['status']}" class="a0 details state">禁止登陆</a>
                                    </if>

                                    <if condition="$row['userInfo'][0]['status'] eq 0">
                                        <a href="javaScript:void(0);" t="{$row['userInfo'][0]['id']}" s="{$row['userInfo'][0]['status']}" class="a0 details state">已禁止</a>
                                    </if>

                                </li>
				 			</ul>
		       </div>
		        <!-- ./col -->
		        <div class="col-lg-2 col-xs-6 alert_box">
		          	<div>
					 		<p class="f14 c2">账户信息</p>
				 			<ul class="pull-left">
				 				<li class="mb-11 f12">账户收益：</li>
				 				<li class="mb-11 f12">发布作品数：</li>
				 				<li class="mb-11 f12">未发布作品数：</li>
				 				<li class="mb-11 f12">收藏作品数：</li>
				 				<li class="f12">读过作品数：</li>
				 			</ul>
				 			<ul class="ml-20 pull-left">
				 				<li class="number1 profit pros1" value="{$row['userInfo'][0]['id']}"><b>¥{$row['acntInfo'][0]['amt_money']|default=0}</b></li>
				 				<li class="number1 profit pros2" value="{$row['userInfo'][0]['id']}"><b>{$row['acntInfo'][0]['releaseCnt']|default=0}</b></li>
				 				<li class="number1 profit pros3" value="{$row['userInfo'][0]['id']}"><b>{$row['acntInfo'][0]['draftCnt']|default=0}</b></li>
				 				<li class="number1 profit pros4" value="{$row['userInfo'][0]['id']}"><b>{$row['acntInfo'][0]['favoriteCnt']|default=0}</b></li>
				 				<li class="number1 profit pros5" value="{$row['userInfo'][0]['id']}"><b>{$row['acntInfo'][0]['readCnt']|default=0}</b></li>
				 			</ul>
					</div>
		        </div>
		        <!-- ./col -->
		        <if condition="!empty($row['labelInfo'][0])">
		        <div class="col-lg-2 col-xs-6 alert_box" id="userLabel_{$row['userInfo'][0]['id']}">
		         	<div>
				 			<p class="f14 c2">用户标签</p>
				 			<ul class="pull-left mr-10 tag-nav">
				 				<php>$i=1;</php>
                                <volist name="row['labelInfo'][0]" id="label">
				 				<li class="tag orange f12 tag_hover1 re" {$i>3?'style="display:none"':''}>
				 					{$key}
				 					   <div class="manager ab">
						 					<span>
                                                <volist name="label" id="item">
                                                    {$item}&nbsp;
                                                </volist>
                                            </span>
						 					<div class="sign ab"></div>
					 					</div>
				 				</li>
                                <php> $i=$i+1;</php>
                                </volist>
                                <li class="tag a0 f12 c2 addtag">添加标签</li>
                                <if condition="$i gt 3">
				 					<li class="tag a0 f12 c2 showAll">{$i}显示全部</li>
				 				</if>
				 			</ul>
						</div>
		        </div>
		        <else/>
		        <!--无数据-->
		        <div class="col-lg-2 col-xs-6 alert_box" id="userLabel_{$row['userInfo'][0]['id']}">
 					<div>
	 				<p class="f14 c2">用户标签</p>
	 					<ul>
			 				<li class="f12 mb-11 c2">无标签</li>
			 				<li><a href="javaScript:void(0);" class="a0 details c-l addlabel">添加标签</a></li>
	 					</ul>
	 				</div>
 				 </div>
		        </if>
		        <!-- ./col -->
		        <if condition="!empty($row['scoreInfo'][0])">
		        <div class="col-lg-4 col-xs-6 alert_box">
		         	<div>
					 			<p class="f14 c2">用户评分</p>
					 			<ul class="progress_score" id="userScoreUL_{$row['userInfo'][0]['id']}">
                                            <volist name="row['scoreInfo'][0]" id="_score">
                                                <li>
                                                    <span class="pull-left w60 f12">{$_score.name}</span>
                                                    <div class="progress progress_style">
                                                        <div class="progress-bar progress_color" role="progressbar"
                                                             aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"
                                                             style="width: {$_score['score']/5*100}%;">
                                                        </div>
                                                    </div>
                                                    <span class="f18 pull-left ml-20">{$_score.score}</span>
                                                </li>
                                            </volist>

               						<li><a href="javaScript:void(0);" class="a0 details c-l score_user ml-230">评分</a></li>
					 			</ul>
					</div>
		        </div>
		        <else/>
		        <!--无数据-->
		        <div class="col-lg-2 col-xs-6 alert_box">
 					<div>
	 				<p class="f14 c2">用户评分</p>
			 			<ul>
			 				<li class="f12 mb-11 c2">尚未评分</li>
			 				<li><a href="javaScript:void(0);" class="a0 details c-l score_user">评分</a></li>
			 			</ul>
	 				</div>
  				</div>
  				</if>
		        
<!--弹窗部分-->        	
					
					<div class="col-lg-8 col-xs-6 author_box">
							<i></i>
							<div class="close_btn"><span uid="{$row['userInfo'][0]['id']}" >关闭</span></div>
									<ul class="top_list" id="top_list">
										<li class="tag_border" value="{$row['userInfo'][0]['id']}">用户标签</li>
										<li onclick="getUserScore({$row['userInfo'][0]['id']})" value="{$row['userInfo'][0]['id']}">用户评分</li>
										<li onclick="getWriteList({$row['userInfo'][0]['id']},1)">已发布<b class="data-num">{$row['acntInfo'][0]['releaseCnt']|default=0}</b></li>
										<li onclick="getWriteList({$row['userInfo'][0]['id']},0)">未发布<b class="data-num">{$row['acntInfo'][0]['draftCnt']|default=0}</b></li>
										<li onclick="readList({$row['userInfo'][0]['id']},1)">收藏<b class="data-num">{$row['acntInfo'][0]['favoriteCnt']|default=0}</b></li>
										<li onclick="readList({$row['userInfo'][0]['id']},0)">读过<b class="data-num">{$row['acntInfo'][0]['readCnt']|default=0}</b></li>
										<li class="no-margin" onclick="getUserAccountInfo({$row['userInfo'][0]['id']})">账户</li>
									</ul>
									<div class="clear"></div>
							
							
									<div class="tag_list_box">
										<!--用户标签弹窗-->
										<div class="tag_list m20 tag_show">
											<ul class="tag_name labelcont"  id="userLabelUL_{$row['userInfo'][0]['id']}"></ul>
											 <ul ><li class="nihao" id="labelUL_{$row['userInfo'][0]['id']}"></li></ul>
											
										</div>
								
										<!--用户评分弹窗-->	
										<div class="tag_list" id="getUserScore_{$row['userInfo'][0]['id']}"></div>	

										<!---已发布无数据---->
										<div class="tag_list">
											<!---------已发布有数据---------->
											<div class="row" id="Book_{$row['userInfo'][0]['id']}">

											</div>

										</div>
										
										<!--------------------未发布----------------------------->
									     <div class="tag_list" >
												 <!--<div>-->
												    <!--<a href="###" class="a0 no_publish">管理未发布作品</a>-->
												 <!--</div>-->
											 <div class="row" id="Book2_{$row['userInfo'][0]['id']}">
											 </div>
										 </div>
										<!------------------------收藏-------------------------->
										<div class="tag_list">

											<!--收藏有数据-->
											<div id="Already_{$row['userInfo'][0]['id']}">
											
											</div>
										</div>
										<!--读过的-->
										<div class="tag_list">
											
											<!--读过的有数据-->
											<div id="Already1_{$row['userInfo'][0]['id']}">
											
											</div>
										</div>
										<!--账户-->
										<div class="tag_list" id="Account_{$row['userInfo'][0]['id']}">
											
										</div>
								
								</div>
							
										

										
									
							
					</div>
					
<!--/.弹窗部分-->				
		    </div>
		  </volist>
			<!--<div class="load_more">-->
				<!--<span>更多用户加载中...</span>-->
			<!--</div>-->
		</div>

    		</div><!--/.row user_list_bor-->
	    		
			</div><!--/.box box-style-->	
		</section>
		
   </div>
</div>

<script src="__PUBLIC__/js/jQuery-2.2.0.min.js"></script>
<script src="__PUBLIC__/js/bootstrap.js"></script>
<script src="__PUBLIC__/js/app.js"></script>
<script src="__PUBLIC__/js/listUser.js"></script>
<script>

    if('{$scoreIds}' == 'NO_SCORE'){
        $('.user_score').html('没有评分');
    }

    if('{$scoreIds}' == 'HAVE_SCORE'){
        $('.user_score').html('有评分');
    }

    if('{$scoreIds}' == ''){
        $('.user_score').html('全部评分');
    }

    if('{$lids}' == 'HAVE_LABEL'){
        $('.user_tag').html('有标签');
    }

    if('{$lids}' == 'NO_LABEL'){
        $('.user_tag').html('没有标签');
    }

    if('{$lids}' == ''){
        $('.user_tag').html('全部标签');
    }

function refreshLabel(uid){
    var _url = '{$Think.config.QS_BASE_PATH}/User/getUserLabel';
    var param = {
        'uid': uid
    };

    $.ajax({
        method: "POST",
        url: _url,
        data: param,
        dataType: 'json',
        success: function(data) {
            $("#userLabel_"+uid).empty();

            var html = "";
            var cnt =0;

            //html += '<li>';
            html += '<div>';
            html += '<p class="f14 c2">用户标签</p>';


            html += '<ul class="pull-left mr-10 tag-nav">';
            $.each(data.labelInfo, function(i, item) {
                var style ="";

                //if(cnt>3){
                    html += '<li class="tag orange f12 tag_hover1 re"   >'+i;
                //}else{
                //    html += '<li class="tag orange f12 tag_hover1 re" >'+i;
                //}

                html += '<div class="manager ab" stye="display:none" >';
                html += '<span>';
                $.each(item, function(k, item2) {
                    html += item + '&nbsp;';
                });
                html += '</span>';
                html += '<div class="sign ab"></div>';
                html += '</div>';

                html += '</li> ';

                cnt++;
            });
            html += '<li class="tag a0 f12 c2 addtag">添加标签</li>';
            html += '</ul>';



            if(cnt>3){
                //html += '<li class="tag a0 f12 c2 showAll"> 显示全部</li>';
            }

            html += '</div>';


            if(cnt==0){
                html ="";
                html += '<div>';
                html += '<p class="f14 c2">用户标签</p>';
                html += '<ul>';
                html += '<li class="f12 mb-11 c2">无标签</li>';
                html += '<li><a href="javaScript:void(0);" class="tag a0 f12 c2 addtag">添加标签</a></li>';
                html += '</ul>';
                html += '</div>';
             }



            $("#userLabel_"+uid).append(html);
            addtagObj.addtagDome();

        }
    });
}


function refreshUserScore(uid) {


    var _url = '{$Think.config.QS_BASE_PATH}/User/getUserAvgScore';
    var param = {
        'uid': uid
    };
    $.ajax({
        method: "POST",
        url: _url,
        data: param,
        dataType: 'json',
        success: function(data) {
            var html = "";

            var cnt = 0;
            $.each(data, function(i, item) {
                html +='<li>';
                html +='<span class="pull-left w60 f12">'+item.name+'</span>';
                html +='<div class="progress progress_style">';
                var par = (item.score/5)*100
                html +='<div class="progress-bar progress_color" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: '+par+'%;">';
                html +='</div>';
                html +='</div>';
                html +='<span class="f18 pull-left ml-20">'+item.score+'</span>';
                html +='</li>';
                cnt++;
            });

            if(cnt==0){
                html +='<li class="f12 mb-11 c2">尚未评分</li>';
            }

            html +=' <li><a href="javaScript:void(0);" class="a0 details c-l score_user ml-230">评分</a></li>';

            $("#userScoreUL_"+uid).empty();
            $("#userScoreUL_"+uid).append(html);

            addtagObj.scoreuserDom();
        }
    });
}


 /**
 *
 * 显示用户被打标签
 * @param uid 用户ID
 **/
function getUserLabel(uid) {
	var _url = '{$Think.config.QS_BASE_PATH}/User/getUserLabel';
	var param = {
		'uid': uid
	};
	$.ajax({
		method: "POST",
		url: _url,
		data: param,
		dataType: 'json',
		success: function(data) {
			var html = "";
			$.each(data.labelInfo, function(i, item) {
					
                html += '<li>';
				html += '<label class="tag orange f12 mr-10 mb-11">' + i + '</label>';

				$.each(item, function(k, item2) {
					html += '<span class="mr-20">' + item2 + '</span>';
				});
				html += '</li>';

			});
			html += '<div class="clear"></div>';
			html += '<span class="span_title">选择标签</span>';
			html += '<div class="clear"></div>';
			
			$("#userLabelUL_"+uid).empty();
			$("#userLabelUL_"+uid).append(html);


            var html = "";
            $.each(data.allLabel, function(i, item) {
                if(item.selected == 1){
                    html += ' <button type="btn" class="tag orange f12 mr-10 mb-11" onclick="cancelLabel(' + item.id + ',' + uid + ')">' + item.name + '</button>';
                }else{
                    html += ' <button type="btn" class="btn_style tag_btn tag_btn1" onclick="labelUser(' + item.id + ',' + uid + ')">' + item.name + '</button>';
                }

            });
            $("#labelUL_"+uid).empty();
            $("#labelUL_"+uid).append(html);
		}
	});
}


/**
 * 给用户取消打标签
 * @param uid 用户ID
 * @param lid 标签ID
 */
function cancelLabel(lid, uid) {
    var _url = '{$Think.config.QS_BASE_PATH}/User/cancelLabel';
    var param = {
        'uid': uid,
        'lid': lid
    };

    //if(window.confirm("你确定要取消吗？")){
        $.ajax({
            method: "POST",
            url: _url,
            data: param,
            dataType: 'json',
            success: function(data) {
                if(data > 0) {
                    alert("取消成功");
                    getUserLabel(uid);
                } else {
                    alert("取消失败！");
                }
            }
        });
    //}
}

/**
 * 给用户打标签
 * @param uid 用户ID
 * @param lid 标签ID
 */
function labelUser(lid, uid) {
	var _url = '{$Think.config.QS_BASE_PATH}/User/labelUser';
	var param = {
		'uid': uid,
		'lid': lid
	};
    //if(window.confirm("你确定要打该标签吗？")) {
        $.ajax({
            method: "POST",
            url: _url,
            data: param,
            dataType: 'json',
            success: function (data) {
                if (data == -1) {
                    alert("您已经对该用户打过该标签！");
                } else {
                    alert("打标签成功");
                    getUserLabel(uid);
                }
            }
        });
    //}
}

/**
 *
 * 显示用户评分
 * @param uid 用户ID
 **/
function getUserScore(uid) {
	var _url = '{$Think.config.QS_BASE_PATH}/User/getUserScore';
	var param = {
		'uid': uid
	};
	$.ajax({
		method: "POST",
		url: _url,
		data: param,
		dataType: 'json',
		success: function(data) {
			var html = "";
			$.each(data, function(userName, item) {

				if('{$_SESSION["LOGIN_USER"]["Profile"]["name"]}' != userName) {

					html += '<div class="score">';
					html += '<p class="f14 c2">' + userName + '的评分</p>';
					html += '<ul class="progress_score">';

					$.each(item, function(key, item2) {
						html += '<li>';
						html += '<span class="pull-left w60 f12">' + item2.labelname + '</span>';
						html += '<div class="progress progress_style">';
						html += '<div class="progress-bar progress_color" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: ' + (item2.score/5)*100  + '%;"></div>';
						html += '</div>';
						html += '<span class="f18 pull-right">' + item2.score + '</span>';
						html += '</li>';
					});
					html += '</ul>';
					html += '</div>';

				} else {
					html += '<div class="score">';
					html += '<p class="f14 c2">我的评分</p>';
					html += '<ul class="progress_score">';
					$.each(item, function(key, item2) {
						html += '<li>';
						html += '<span class="pull-left w60 f12">' + item2.labelname + '</span>';
						html += '<div class="progress progress_style">';
						html += '<div class="progress-bar progress_color" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: ' + (item2.score/5)*100 + '%;"></div>';
						html += '</div>';
						html += '<div class="score1 pull-right">';
						html += '<input id="s_' + uid + '_' + item2.lid + '"   type="number"  min="1" max="5"   class="f18 myscore" value="' + item2.score + '" onblur="scoreUser(this)" />';
						html += '</div>';
						html += '</li>';
					});
					html += '</ul>';
					html += '</div>';
				}
			});
			
			$("#getUserScore_"+uid).empty();
			$("#getUserScore_"+uid).append(html);
		}
	});
}
/**
 * 给用户打分
 * @param item
 */
function scoreUser(item) {

	var id = item.id;
	var ary = item.id.split("_");
	var uid = ary[1];
	var lid = ary[2];
	var score = item.value;

	if(score > 5) {
		alert("请输入不大于5的数字");
		item.focus();
		return;
	}
	var _url = '{$Think.config.QS_BASE_PATH}/User/scoreUser';
	var param = {
		'uid': uid,
		'lid': lid,
		'score': score
	};
	$.ajax({
		method: "POST",
		url: _url,
		data: param,
		dataType: 'json',
		success: function(data) {
			if(data != -1) {
				alert("打分成功");
				getUserScore(uid);
			} else {
				alert("打分失败");
			}
		}
	});
}

function   getLocalTime(nS)   {
   return   new Date(parseInt(nS) * 1000).toLocaleString().replace(/年|月/g, "-").replace(/日/g, " ");
}


/**
 * 获取已发布、未发布信息
 * @param uid 用户ID
 * @param type 类型
 */
function getWriteList(uid,type) {
	var _url = '{$Think.config.QS_BASE_PATH}/User/getWriteList';
	var param = {
		'uid': uid,
		'type': type
	};
	$.ajax({
		method: "POST",
		url: _url,
		data: param,
		dataType: 'json',
		success: function(data) {
			var html = "";
			$.each(data, function(i, item) {
				html+='<div class="col-lg-12 collect_border">';
				html+='<ul class="already">';
				
				if(type==1){
					html+='<li><h3 class="c3"> <a target="_blank" href="http://www.qiaobooks.com/read/'+item.bid+'">'+item.bookname+'</a></h3><span class="f12 c4 ml-20">创建于 '+getLocalTime(item.ctime)+'</span><a href="{$Think.config.QS_BASE_PATH}/Book/bookList/bid/'+item.bid+'" class="a0 work_detail mr-20 pull-right">管理</a></li>';
					html+='</ul>';
					html+='<div class="clear"></div>';
					html+='<ul class="detail">';
					html+='<li>';
					html+='<span class="mr-10">定价</span><b>'+item.price+'</b>';
					html+='</li>';
					html+='<li>';
					html+='<span class="mr-10">字数</span><b>'+item.word_cnt+'</b>';
					html+='</li>';
					html+='<li>';
					html+='<span class="mr-10">阅读</span><b>'+item.read_cnt+'</b>';
					html+='</li>';
					html+='<li>';
					html+='<span class="mr-10">购买</span><b>'+item.buy_cnt+'</b>';
					html+='</li>';
					html+='<li>';
					html+='<span class="mr-10">分享</span><b>'+item.share_cnt+'</b>';
					html+='</li>';
                    html+='<li>';
                    html+='<span class="mr-10">收藏</span><b>'+item.mark_cnt+'</b>';
                    html+='</li>';
					html+='<div class="clear"></div>';
					html+='<p><span class="mr-10">发布时间</span><b>'+ getLocalTime(item.utime)+'</b></p>';
					html+='<div class="row">';
					html+='<div class="col-md-8">';
					html+='<div class="pull-left f14 mr-20">作品评分</div>';
					html+='<ul class="progress_score pull-left mr-10">';

                    var recCnt=0;
                    if(item.scoreinfo!='scoreinfo') {
                        $.each(item.scoreinfo, function (k, _score) {
                            html += '<li>';
                            html += '<span class="pull-left f12 w50 mr-10">' + _score.name + '</span>';
                            html += '<div class="progress progress_style1">';
                            var width = (_score.score / 5) * 100
                            html += '<div class="progress-bar purple" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: ' + width + '%;"></div>';
                            html += '</div>';
                            html += '<div class="f18 pull-right ml-10">' + _score.score + '</div>';
                            html += '</li>';
                            recCnt++;
                        });
                    }
                    if(recCnt==0){
                        html+='<li class="f12">尚未评分</li>';
                        html+='<li class="no-margin"><a href="{$Think.config.QS_BASE_PATH}/Book/bookList/bid/'+item.bid+'"  class="a0 grade no-margin">评分</a></li>';
                    }

                    html += '</ul>';
                    html += '</div>';
                    html += '<div class="pull-left col-md-4">';
                    html += '<div class="pull-left f14 mr-20">作品标签</div>';
                    html += '<div class="pull-left">';
                    html += '<ul class="mb-2">';

                    recCnt=0;
                    if(item.labelinfo != 'labelinfo') {
                        $.each(item.labelinfo, function (m, _label) {
                            html += '<li class="work_tag">' + _label.lname + '</li>';
                            recCnt++;
                        });
                    }
                    if(recCnt==0){
                        html+='<li class="f12">尚未添加标签</li>';
                        html+='<li class="no-margin"><a href="{$Think.config.QS_BASE_PATH}/Book/bookList/bid/'+item.bid+'"  class="a0 grade no-margin">追加标签</a></li>';
                    }

                    html += '</ul>';
                    html += '<div class="clear"></div>';
                    html += '</div>';
                    html += '<div class="clear"></div>';
					html+='</div>';
					html+='</div>';
					html+='</div>';
				}else if(type==0){
					html+='<li><h3 class="c3"><a target="_blank" href="http://www.qiaobooks.com/read/'+item.bid+'">'+item.bookname+'</a></h3><span class="f12 c4 ml-20">创建时间 '+getLocalTime(item.ctime)+'</span></li>';
					html+='</ul>';	
					html+='<div class="clear"></div>';
					html+='<ul class="detail">';	
					html+='<li class="mr-128">';
					html+='<span class="mr-10">总字数</span> <b>'+item.word_cnt+'</b>';
					html+='</li>';
					html+='<li>';
					html+='<span class="mr-10">最后保存时间</span><b>'+getLocalTime(item.lutime)+'</b>';
					html+='</li>';
					html+='</ul>';
					html+='<div class="clear"></div></div>';
				}
				
			});

            if(html ==''){
                html="未查询到相关记录!"
            }
			if(type==1){
				$("#Book_"+uid).empty();
				$("#Book_"+uid).append(html);
			}else if(type==0){
				$("#Book2_"+uid).empty();
				$("#Book2_"+uid).append(html);
			}
		}
	});
}


/**
 * 获取收藏、读过的信息
 * @param uid 用户ID
 * @param type 类型
 */
function readList(uid,type) {
	var _url = '{$Think.config.QS_BASE_PATH}/User/readList';
	var param = {
		'uid': uid,
		'type': type
	};
	$.ajax({
		method: "POST",
		url: _url,
		data: param,
		dataType: 'json',
		success: function(data) {
			var html = "";

			$.each(data, function(i, item) {
				html+='<div class="row collect_border">';
				html+='<div class="col-lg-12">';
				html+='<ul class="already">';

				html+='<li><h3 class="c3"> <a target="_blank" href="http://www.qiaobooks.com/read/'+item.bid+'">'+item.bookname+'</a></h3><span class="f12 c4 ml-20"><span class="c3"> <a target="_blank" href="http://www.qiaobooks.com/Home/'+item.authorid+'">'+item.authorname[0]['authorname']+'&nbsp;&nbsp;</a></span>发布于 '+getLocalTime(item.utime)+'</span><a href="{$Think.config.QS_BASE_PATH}/Book/bookList/bid/'+item.bid+'" class="a0 work_detail mr-20 pull-right">管理</a></li>';
				html+='</ul>';
				html+='<div class="clear"></div>';
				html+='<ul class="detail">';
				html+='<li>';
				html+='<span class="mr-10">定价</span><b>'+item.price+'</b>';
				html+='</li>';
				html+='<li>';
				html+='<span class="mr-10">字数</span><b>'+item.word_cnt+'</b>';
				html+='</li>';
				html+='<li>';
				html+='<span class="mr-10">阅读</span><b>'+item.read_cnt+'</b>';
				html+='</li>';
				html+='<li>';
				html+='<span class="mr-10">购买</span><b>'+item.buy_cnt+'</b>';
				html+='</li>';
				html+='<li>';
				html+='<span class="mr-10">分享</span><b>'+item.share_cnt+'</b>';
				html+='</li>';
                html+='<li>';
                html+='<span class="mr-10">收藏</span><b>'+item.mark_cnt+'</b>';
                html+='</li>';
				html+='<div class="clear"></div>';
				if(type==1){
					html+='<p><span class="mr-10">收藏时间</span><b>'+getLocalTime(item.readtime)+'</b></p>';
				}else if(type==0){
					html+='<p><span class="mr-10">阅读时间</span><b>'+getLocalTime(item.readtime)+'</b></p>';
				}
				html+='<div class="row">';
				html+='<div class="col-md-8">';
				html+='<div class="pull-left f14 mr-20">作品评分</div>';
				html+='<ul class="progress_score pull-left mr-10">';

                var recCnt=0;

                if(item.scoreinfo!='scoreinfo'){
                    $.each(item.scoreinfo, function(k, _score) {
                        html+='<li>';
                        html+='<span class="pull-left f12 w50 mr-10">'+_score.name+'</span>';
                        html+='<div class="progress progress_style1">';
                        var width= (_score.score/5)*100
                        html+='<div class="progress-bar purple" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: '+width+'%;"></div>';
                        html+='</div>';
                        html+='<div class="f18 pull-right ml-10">'+_score.score+'</div>';
                        html+='</li>';
                        recCnt++;
                    });
                }
                if(recCnt==0){
                    html+='<li class="f12">尚未评分</li>';
                    html+='<li class="no-margin"><a href="{$Think.config.QS_BASE_PATH}/Book/bookList/bid/'+item.bid+'"  class="a0 grade no-margin">评分</a></li>';
                }

				html+='</ul>';
				html+='</div>';
				html+='<div class="col-md-4">'
				html+='<div class="pull-left">';
				html+='<div class="pull-left f14 mr-20">作品标签</div>';
				html+='<div class="pull-left">';
				html+='<ul class="mb-2">';
                recCnt=0;
                if(item.labelinfo!='labelinfo') {
                    $.each(item.labelinfo, function (m, _label) {
                        html += '<li class="work_tag">' + _label.lname + '</li>';
                        recCnt++;
                    });
                }
                if(recCnt==0){
                    html+='<li class="f12">尚未添加标签</li>';
                    html+='<li class="no-margin"><a href="{$Think.config.QS_BASE_PATH}/Book/bookList/bid/'+item.bid+'"  class="a0 grade no-margin">追加标签</a></li>';
                }

				html+='</ul>';
				html+='<div class="clear"></div>';
				html+='<ul>';
//				html+='<li class="work_tag">'+item.price+'</li>';
                if(recCnt>3) {
                    html += '<li class="work_tag show_all">显示全部</li>';
                }
				html+='</div>';
				html+='<div class="clear"></div>';
				html+='</div>';
				html+='</div>';
				html+='</div>';
				html+='</div>';
				html+='</div>';
			});

            if(html ==""){
                html="未查询到相关记录!"
            }

			if(type==1){
				$("#Already_"+uid).empty();
				$("#Already_"+uid).append(html);
			}else if(type==0){
				$("#Already1_"+uid).empty();
				$("#Already1_"+uid).append(html);
			}
			
		}
	});
}
/**
 * 获取账户信息
 * @param uid 用户ID
 *
 */
function getUserAccountInfo(uid) {
	var _url = '{$Think.config.QS_BASE_PATH}/User/getUserAccountInfo';
	var param = {
		'uid': uid
	};
	$.ajax({
		method: "POST",
		url: _url,
		data: param,
		dataType: 'json',
		success: function(data) {
			var html = "";
			var amt = data.amt;
		    var left = data.left;
		    
		    var gains_history = data.gains_history;
		    var buy_history = data.buy_history;
		    var cash_history = data.cash_history;

		    	html+='<ul class="account c2">';
				html+='<li>总收益：<span class="f14 c3">&nbsp;'+amt+'</span></li>';
				html+='<li>账户余额:<span class="f14 c3">&nbsp;&nbsp;'+left+'</span></li>';
				html+='</ul>';
				html+='<div class="clear"></div>';
				html+='<div class="accounts" id="account_btn">';
				html+='<a href="###" class="a0 account_btn active1 gains_'+uid+'"  onclick="showDiv(\'gains_'+uid+'\')">收益</a>';
				html+='<a href="###" class="a0 account_btn gains1_'+uid+'"  onclick="showDiv(\'gains1_'+uid+'\')">消费</a>';
				html+='<a href="###" class="a0 account_btn gains2_'+uid+'"  onclick="showDiv(\'gains2_'+uid+'\')">提现</a>';
				html+='</div>';
				html+='<div class="box-body">';
				html+='<table id="gains_'+uid+'" class="table table-bordered">';
				html+='<thead>';
				html+='<tr>';
				html+='<th class="col-md-2">时间</th>';
				html+='<th>作品</th>';
				html+='<th>购买者</th>';
				html+='<th>金额</th>';
				html+='</tr>';
				html+='</thead>';
				html+='<tbody>';

                $.each(gains_history, function(k, _history) {
                    html += '<tr>';
                    html += '<td>' + _history.pay_time + '</td>';
                    html += '<td><a target="_blank" href="{$Think.config.QS_BASE_PATH}/Book/bookList/bid/'+_history.bid+'">' + _history.book_name + '</a></td>';
                    html += '<td><a target="_blank" href="{$Think.config.QS_BASE_PATH}/User/listUser/uid/'+_history.uid+'">' + _history.nick_name + '</a></td>';
                    html += '<td>' + _history.money + '</td>';
                    html += '</tr>';
                });


				html+='</tbody>';
				html+='</table>';
				
				html+='<table id="gains1_'+uid+'" class="table table-bordered example1">';
				html+='<thead>';
				html+='<tr>';
				html+='<th class="col-md-2">时间</th>';
				html+='<th>作品</th>';
				html+='<th>作者</th>';
				html+='<th>金额</th>';
				html+='</tr>';
				html+='</thead>';
				html+='<tbody>';


                $.each(buy_history, function(l, _b) {
                    html += '<tr>';
                    html += '<td>' + _b.pay_time + '</td>';
                    html += '<td><a target="_blank" href="{$Think.config.QS_BASE_PATH}/Book/bookList/bid/'+_b.bid+'">' + _b.book_name + '</a></td>';
                    html += '<td><a target="_blank" href="{$Think.config.QS_BASE_PATH}/User/listUser/uid/'+_b.author_id+'">' + _b.nick_name + '</a></td>';
                    html += '<td>' + _b.money + '</td>';
                    html += '</tr>';
                });



				html+='</tbody>';
				html+='</table>';
				
				html+='<table id="gains2_'+uid+'" class="table table-bordered example1">';
				html+='<thead>';
				html+='<tr>';
				html+='<th class="col-md-2">申请时间</th>';
				html+='<th>提现金额</th>';
				html+='<th>提现渠道</th>';
				html+='<th>处理状态</th>';
                html+='<th>处理时间</th>';
				html+='</tr>';
				html+='</thead>';
				html+='<tbody>';

                $.each(cash_history, function(n, _c) {
                    html += '<tr>';
                    html += '<td>' + _c.apply_date + '</td>';
                    html += '<td>' + _c.money + '</td>';

                    if(_c.pay_type==0){
                        html += '<td>支付宝</td>';
                    }else{
                        html += '<td>微信</td>';
                    }

                    if(_c.status==0){
                        html += '<td>申请中</td>';
                    }else if (_c.status==1) {
                        html += '<td>已同意</td>';
                    }else {
                        html += '<td>已拒绝</td>';
                    }

                    html += '<td>' + _c.pay_time + '</td>';
                    html += '</tr>';
                });

				html+='</tbody>';
				html+='</table>';
				html+='</div>'
			$("#Account_"+uid).empty();
			$("#Account_"+uid).append(html);
		}
	});
}
/**
 * 备注用户
 * @param com
 */
function remarkUser(id,com){
    var _url = '{$Think.config.QS_BASE_PATH}/User/remarkUser';
    var remark = com.value;
    var oldval = $("#remark_"+id).attr('oldval');
    var param = {
        'id': id,
        'remark': remark,
        'oldval':oldval
    };
    if(remark!=oldval){
    	 $.ajax({
        method: "POST",
        url: _url,
        data: param,
        dataType: 'json',
        success: function(data) {
            if(data > 0) {
                alert("备注成功");
            } else {
                alert("备注失败");
            }
        }
    });
    }
   
}

/**
 * 搜索
  */
function doSearch(){
  $("#userForm").submit();
}
/**
 * 排序
 * @param fieldName
 */
function setSort(fieldName){
    $('#gotoPage').val(1);
    $('#sort').val(fieldName);
    doSearch();

}

/**
 * 跳转页
 * @param com
 */
function setPageNum(pageNum){
    $('#gotoPage').val(pageNum);
    doSearch();
}

$("#aGoPage").change(function(){
    var pageNum = $("#aGoPage option:selected").text();
    $('#gotoPage').val(pageNum);
    doSearch();
});

/**
 * 选择标签页
 * @param lid
 */
function setLabel(lid){
//  $('#lids').val(lid);
//  doSearch();
}


/**
 * 选择所有标签页
 * @param lid
 */
function allLabel(){
    $('#gotoPage').val(1);
    $('#lids').val("");
    doSearch();
}

    /**
 * 有标签页
 * @param lid
 */
function haveLabel(){
    $('#gotoPage').val(1);
    $('#lids').val("HAVE_LABEL");
    doSearch();
}

/**
 * 选择所有标签页
 * @param lid
 */
function noLabel(){
    $('#gotoPage').val(1);
    $('#lids').val("NO_LABEL");
    doSearch();
}

/**
 * 选择评分
 * @param lid 标签id
 * @param score 分数id
 */
function setScore(lid,score){
//	alert($(this).attr('class'));	
 
 
}

/**
 * 选择有评分
 */
function allScore(){
    $('#scoreIds').val("");
    $('#gotoPage').val(1);
    doSearch();
}

/**
 * 选择有评分
 */
function haveScore(){
    $('#scoreIds').val("HAVE_SCORE");
    $('#gotoPage').val(1);
    doSearch();
}
/**
 * 没评分
 */
function noScore(){
    $('#scoreIds').val("NO_SCORE");
    $('#gotoPage').val(1);
    doSearch();
}

/**
 * 跳转页
 */
function gotoPage(pageNum){
    $('#gotoPage').val(pageNum);
    doSearch();
}
//表格显示
function showDiv(target){
    $('#account_btn').children("."+target).addClass('active1').siblings().removeClass("active1");
    $('#'+target).show().siblings().hide();
}
</script>
</body>
</html>
